name: Keep Render Service Alive

on:
  schedule:
    # à¸£à¸±à¸™à¸—à¸¸à¸ 10 à¸™à¸²à¸—à¸µà¹€à¸à¸·à¹ˆà¸­à¸›à¹‰à¸­à¸‡à¸à¸±à¸™ Render Free Tier à¸«à¸¥à¸±à¸š (backup à¸ªà¸³à¸«à¸£à¸±à¸š UptimeRobot)
    - cron: '*/10 * * * *'
  
  # à¸­à¸™à¸¸à¸à¸²à¸•à¹ƒà¸«à¹‰à¸£à¸±à¸™ manual à¹„à¸”à¹‰à¸”à¹‰à¸§à¸¢
  workflow_dispatch:

jobs:
  keep-alive:
    runs-on: ubuntu-latest
    
    steps:
    - name: Ping LINE Bot Service
      run: |
        echo "ğŸƒ Pinging LINE Bot to keep it awake..."
        echo "ğŸ• Current time: $(date)"
        
        # Multiple endpoint pings with better error handling
        HEALTH_STATUS=0
        ROOT_STATUS=0
        
        echo "ğŸ“¡ Pinging ultra-fast ping endpoint..."
        if curl -f -s --max-time 15 https://line-group-reminder-bot.onrender.com/ping; then
          echo "âœ… Ping endpoint: OK"
          HEALTH_STATUS=1
        else
          echo "âŒ Ping endpoint: Failed"
        fi
        
        sleep 2
        
        echo "ğŸ“¡ Pinging alive endpoint..."
        if curl -f -s --max-time 15 https://line-group-reminder-bot.onrender.com/alive; then
          echo "âœ… Alive endpoint: OK"
        else
          echo "âŒ Alive endpoint: Failed"
        fi
        
        sleep 2
        
        echo "ğŸ“¡ Pinging healthz endpoint..."
        if curl -f -s --max-time 15 https://line-group-reminder-bot.onrender.com/healthz; then
          echo "âœ… Healthz endpoint: OK"
        else
          echo "âŒ Healthz endpoint: Failed"
        fi
        
        sleep 2
        
        echo "ğŸ“¡ Pinging root endpoint..."
        if curl -f -s --max-time 15 https://line-group-reminder-bot.onrender.com/; then
          echo "âœ… Root endpoint: OK"
          ROOT_STATUS=1
        else
          echo "âŒ Root endpoint: Failed"
        fi
        
        # à¸–à¹‰à¸²à¸—à¸±à¹‰à¸‡ health à¹à¸¥à¸° root à¸¥à¹‰à¸¡à¹€à¸«à¸¥à¸§ à¹ƒà¸«à¹‰ workflow fail
        if [ $HEALTH_STATUS -eq 0 ] && [ $ROOT_STATUS -eq 0 ]; then
          echo "ğŸ’€ All endpoints failed - service might be down!"
          exit 1
        fi
        
        echo "âœ… Keep-alive ping completed"
        echo "â° Next ping in 10 minutes"
    
    - name: Log Status
      run: |
        echo "ğŸ“Š Keep-Alive Status Report:"
        echo "ğŸ• Time: $(date)"
        echo "ğŸŒ Service: line-group-reminder-bot.onrender.com" 
        echo "ğŸ“¡ Ping Status: Success"
        echo "ğŸ”„ Next execution: $(date -d '+10 minutes')"
        echo "ğŸ”” Note: Primary keep-alive via UptimeRobot (5min), GitHub Actions as backup (10min)"