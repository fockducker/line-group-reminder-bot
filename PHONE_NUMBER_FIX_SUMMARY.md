# ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤ Phone Number ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å

## ‡∏™‡∏£‡∏∏‡∏õ‡∏õ‡∏±‡∏ç‡∏´‡∏≤
‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ß‡πà‡∏≤ **‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• phone number ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏£‡∏∞‡∏ö‡∏∏‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß** ‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö structured format:

```
‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ
‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: 15 ‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏° 2567
‡πÄ‡∏ß‡∏•‡∏≤: 10:00
‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà: ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå
‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£/‡πÅ‡∏ú‡∏ô‡∏Å/‡∏ä‡∏±‡πâ‡∏ô: ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ A ‡∏ä‡∏±‡πâ‡∏ô 3 ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≠‡∏≤‡∏¢‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°
‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•/‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠: ‡∏ô‡∏û.‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ
‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£: "02-419-7000"
```

## ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏õ‡∏±‡∏ç‡∏´‡∏≤

### 1. ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Parser
- ‚úÖ **SmartDateTimeParser** ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á - ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ extract ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£: "02-419-7000" ‡πÑ‡∏î‡πâ
- ‚úÖ **Regex pattern** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö phone_number ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: `r'(?:‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£|‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå):\s*["\']?([^"\'\r\n]+)["\']?'`

### 2. ‡∏Ñ‡πâ‡∏ô‡∏û‡∏ö‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏´‡∏•‡∏±‡∏Å
1. **‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö structured format ‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î** - `_parse_structured_appointment()` return `None` ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç:
   ```python
   if '‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢:' not in text and '‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤:' not in text:
       return None
   ```
   ‡πÅ‡∏ï‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ä‡πâ `‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢:` ‡πÅ‡∏•‡∏∞ `‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:`+`‡πÄ‡∏ß‡∏•‡∏≤:` ‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ô

2. **Field extraction patterns ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà** - ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö:
   - `‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢:` (‡πÅ‡∏ó‡∏ô `‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢:`)
   - `‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:` + `‡πÄ‡∏ß‡∏•‡∏≤:` ‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ô (‡πÅ‡∏ó‡∏ô `‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤:`)
   - `‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£/‡πÅ‡∏ú‡∏ô‡∏Å/‡∏ä‡∏±‡πâ‡∏ô:` (‡πÅ‡∏ó‡∏ô `‡πÅ‡∏ú‡∏ô‡∏Å:`)
   - `‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•/‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠:` (‡πÅ‡∏ó‡∏ô `‡πÅ‡∏û‡∏ó‡∏¢‡πå:`)

3. **handlers.py ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ parsed phone_number** - ‡∏´‡∏≤‡∏Å parser ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‡∏à‡∏∞ fallback ‡πÑ‡∏õ complex parsing ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö phone_number

## ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£

### 1. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç `utils/datetime_parser.py`

#### ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö structured format:
```python
# ‡πÄ‡∏î‡∏¥‡∏°
if '‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢:' not in text and '‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤:' not in text:
    return None

# ‡πÉ‡∏´‡∏°‡πà - ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö  
has_title = any(keyword in text for keyword in ['‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢:', '‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢:'])
has_datetime = any(keyword in text for keyword in ['‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤:', '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:', '‡πÄ‡∏ß‡∏•‡∏≤:'])

if not (has_title or has_datetime):
    return None
```

#### Title extraction:
```python
# ‡πÄ‡∏î‡∏¥‡∏°
title = self._extract_field(text, r'‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢:\s*["\']?([^"\'\r\n]+)["\']?')

# ‡πÉ‡∏´‡∏°‡πà - ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö "‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢:"
title = (self._extract_field(text, r'(?:‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢|‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢):\s*["\']?([^"\'\r\n]+)["\']?') or
        self._extract_field(text, r'‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢:\s*["\']?([^"\'\r\n]+)["\']?'))
```

#### DateTime extraction:
```python
# ‡πÄ‡∏î‡∏¥‡∏°
datetime_str = self._extract_field(text, r'‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤:\s*["\']?([^"\'\r\n]+)["\']?')

# ‡πÉ‡∏´‡∏°‡πà - ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: + ‡πÄ‡∏ß‡∏•‡∏≤: ‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ô
datetime_str = self._extract_field(text, r'‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤:\s*["\']?([^"\'\r\n]+)["\']?')
if not datetime_str:
    date_part = self._extract_field(text, r'‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:\s*["\']?([^"\'\r\n]+)["\']?')
    time_part = self._extract_field(text, r'‡πÄ‡∏ß‡∏•‡∏≤:\s*["\']?([^"\'\r\n]+)["\']?')
    if date_part and time_part:
        datetime_str = f"{date_part} {time_part}"
    elif date_part:
        datetime_str = date_part
```

#### Building/Floor/Dept extraction:
```python
# ‡πÄ‡∏î‡∏¥‡∏°
building_floor_dept = (self._extract_field(text, r'(?:‡πÅ‡∏ú‡∏ô‡∏Å|‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£|‡∏ä‡∏±‡πâ‡∏ô):\s*["\']?([^"\'\r\n]+)["\']?') or
                      self._extract_field(text, r'‡πÅ‡∏ú‡∏ô‡∏Å:\s*["\']?([^"\'\r\n]+)["\']?'))

# ‡πÉ‡∏´‡∏°‡πà - ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö "‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£/‡πÅ‡∏ú‡∏ô‡∏Å/‡∏ä‡∏±‡πâ‡∏ô:"
building_floor_dept = (self._extract_field(text, r'(?:‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£/‡πÅ‡∏ú‡∏ô‡∏Å/‡∏ä‡∏±‡πâ‡∏ô|‡πÅ‡∏ú‡∏ô‡∏Å|‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£|‡∏ä‡∏±‡πâ‡∏ô):\s*["\']?([^"\'\r\n]+)["\']?') or
                      self._extract_field(text, r'‡πÅ‡∏ú‡∏ô‡∏Å:\s*["\']?([^"\'\r\n]+)["\']?'))
```

#### Contact Person extraction:
```python
# ‡πÄ‡∏î‡∏¥‡∏°
contact_person = (self._extract_field(text, r'(?:‡πÅ‡∏û‡∏ó‡∏¢‡πå|‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•|‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠):\s*["\']?([^"\'\r\n]+)["\']?') or
                 self._extract_field(text, r'‡πÅ‡∏û‡∏ó‡∏¢‡πå:\s*["\']?([^"\'\r\n]+)["\']?'))

# ‡πÉ‡∏´‡∏°‡πà - ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö "‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•/‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠:"
contact_person = (self._extract_field(text, r'(?:‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•/‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠|‡πÅ‡∏û‡∏ó‡∏¢‡πå|‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•|‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠):\s*["\']?([^"\'\r\n]+)["\']?') or
                 self._extract_field(text, r'‡πÅ‡∏û‡∏ó‡∏¢‡πå:\s*["\']?([^"\'\r\n]+)["\']?'))
```

### 2. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç `handlers.py`

#### ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£ extract ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏à‡∏≤‡∏Å parsed_info:
```python
# ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£ extract ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÉ‡∏´‡∏°‡πà
location = parsed_info.get('location', '')
building_floor_dept = parsed_info.get('building_floor_dept', '')
contact_person = parsed_info.get('contact_person', '')
phone_number = parsed_info.get('phone_number', '')
```

#### ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô Appointment object:
```python
# ‡πÄ‡∏î‡∏¥‡∏°
appointment = Appointment(
    id=str(uuid.uuid4())[:8],
    group_id=group_id_for_model,
    datetime_iso=appointment_datetime.isoformat(),
    location=hospital,  # ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤
    building_floor_dept=department,  # ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤
    contact_person=doctor if doctor != "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏" else "",  # ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤
    phone_number="",  # hardcoded ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á!
    note=title
)

# ‡πÉ‡∏´‡∏°‡πà
appointment = Appointment(
    id=str(uuid.uuid4())[:8],
    group_id=group_id_for_model,
    datetime_iso=appointment_datetime.isoformat(),
    location=location,  # ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å parser
    building_floor_dept=building_floor_dept,  # ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å parser
    contact_person=contact_person,  # ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å parser
    phone_number=phone_number,  # ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å parser
    note=title
)
```

## ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö

### ‚úÖ Parser ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á:
```
INFO:utils.datetime_parser:Parsing structured appointment: ...
INFO:utils.datetime_parser:Structured parsing successful: 15/12/2567 10:00

phone_number: '02-419-7000'
```

### ‚úÖ Appointment Object ‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏° phone_number:
```
Appointment Object ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô:
   - Phone Number: '02-419-7000'

‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Phone Number:
   ‚úÖ PASS: Phone number ‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å = '02-419-7000'
```

## ‡∏™‡∏£‡∏∏‡∏õ
üéâ **‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÅ‡∏•‡πâ‡∏ß!**

- ‚úÖ SmartDateTimeParser ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö structured format ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß
- ‚úÖ Phone number ‡∏ñ‡∏π‡∏Å extract ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á  
- ‚úÖ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö backward compatibility ‡∏Å‡∏±‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏°
- ‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà

‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏•‡∏∞ phone_number ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Google Sheets ‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥!